% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/simulation.R
\name{possible_parents_FA}
\alias{possible_parents_FA}
\title{Possible Parental Alleles Under Finite Alleles Model}
\usage{
possible_parents_FA(child, states, states_matrix, T_prob, M)
}
\arguments{
\item{child}{A character vector of length \eqn{S} representing the allele
state of the child at \eqn{S} sites.}

\item{states}{A named list of valid lumped allele states indexed by their
string representations.}

\item{states_matrix}{A numeric matrix encoding allele state transitions
for efficient lookup.}

\item{T_prob}{A precomputed transition probability structure used for
validating compatible parent states. Should correspond to the same mutation
model used throughout.}

\item{M}{An integer matrix where \code{M[i, i]} gives the number of possible
alleles at site \eqn{i}, and \code{M[i, j]} (for \eqn{i < j}) gives the
number of alleles for a mutation overlap spanning from site \eqn{i} to \eqn{j}.}
}
\value{
A list where each element is a character vector representing a valid
parental allele configuration that could give rise to the child allele through
mutation or overlapping events.
}
\description{
Given an observed allele state at a node (child), this function returns all
possible allele states of its parent under a finite alleles mutation model
with potential overlapping mutations. The function accounts for cases where
mutations at multiple sites overlap in state space and may mask earlier mutations.
}
\details{
The output is a list where each element is a character vector of length \eqn{S}
representing a valid allele configuration in the parent that could lead to the
child allele through mutation and masking events. The number of such configurations
can grow exponentially in the case of overlapping or masked mutations.

Parent states are determined according to lumped allele categories (i.e.\ allele
states grouped based on their mutation class). The mutation landscape is defined by:
\itemize{
  \item \code{M[i, i]}: number of alleles allowed at site \eqn{i}
  \item \code{M[i, j]}: number of alleles allowed for an overlap spanning sites
  \eqn{i} through \eqn{j} (inclusive)
}

If the child is the ancestral type (i.e., no derived mutations), then only the
ancestral allele is returned. For overlapping alleles, the function calls
\code{all_allele_states()} to enumerate fully expanded/masked possibilities.
}
