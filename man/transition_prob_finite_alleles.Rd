% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/simulation.R
\name{transition_prob_finite_alleles}
\alias{transition_prob_finite_alleles}
\title{Compute Transition Probabilities Between Allele States Under Finite Alleles Model}
\usage{
transition_prob_finite_alleles(
  parent,
  child,
  Pt,
  states,
  M,
  parent_m = NULL,
  child_m = NULL,
  k = NULL,
  j = NULL,
  mu = NULL
)
}
\arguments{
\item{parent}{A character vector of length \eqn{S} representing the parental allele
state across all sites.}

\item{child}{A character vector of length \eqn{S} representing the child allele
state across all sites.}

\item{Pt}{A numeric matrix representing the transition probabilities between
lumped mutation states (typically computed as
\eqn{V \cdot \exp(\Lambda t) \cdot V^{-1}} from eigendecomposition of the rate matrix).}

\item{states}{A named list mapping lumped allele states (as character strings)
to integer indices used to access rows/columns of \code{Pt}.}

\item{M}{An integer matrix where \code{M[i, i]} gives the number of possible alleles
for a single-site mutation at site \eqn{i}, and
\code{M[i, j]} (for \eqn{i < j}) gives the number of possible alleles for an overlapping
segment from site \eqn{i} to \eqn{j}.}

\item{parent_m}{Optional numeric vector of length \eqn{S}, giving the lumped mutation
state of the parent; computed using \code{\link{lumped_state}} if not provided.}

\item{child_m}{Optional numeric vector of length \eqn{S}, giving the lumped mutation
state of the child, computed if missing.}

\item{k}{Optional integer index for the row of \code{Pt} corresponding to \code{parent_m};
computed from \code{states} if missing.}

\item{j}{Optional integer index for the column of \code{Pt} corresponding to \code{child_m};
computed if missing.}

\item{mu}{Optional list of custom mutation probability distributions. If provided,
\code{mu[[s]][[1]]} or \code{mu[[s]][[j - s + 1]]} should give a named vector of allele
probabilities for single-site or multi-site overlaps, respectively.}
}
\value{
A numeric scalar giving the transition probability from \code{parent} to
\code{child} along an edge, based on the model and mutation parameters.
}
\description{
Computes the probability of transitioning from a given parental allele state to
a child allele state along an edge of a phylogenetic tree, under a finite alleles
mutation model. The calculation accounts for both mutation state transitions (lumped
representation) and allele-level resolutions, assuming either uniform mutation
probabilities or user-provided mutation schemes.
}
\details{
The transition probability between two allele states is calculated in two stages:
\enumerate{
  \item The probability of transitioning between their corresponding lumped mutation
  states, obtained using the lumped transition probability matrix \code{Pt}.
  \item The probability of resolving the actual alleles consistent with the mutation
  states, based on either:
    \itemize{
      \item a uniform distribution of possible alleles drawn from matrix \code{M}, or
      \item a user-provided mutation probability structure \code{mu}.
    }
}

If any allele-level mismatch cannot be reconciled by the transition, the function
returns zero probability.
}
